@model Schedulator.Models.ScheduleGenerator

@{
    var count = 1;
}

@foreach (List<Schedulator.Models.Schedule> schedule in Model.Schedules) {
    <div id="schedCount">#@count</div>
    count++;

    <table border="0" align="center" class="genScheduleRslt">
        <tbody>
            <tr>
                <td valign="top"> @GenScheduleLegend(schedule) </td>

                <td>
                    <table border="0" cellpadding="3" cellspacing="0">
                        <tbody>
                            <tr><td align="center"></td></tr>
                            <tr>
                                <td valign="top">@Html.Partial("_Schedule", schedule.FirstOrDefault())</td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                @if (schedule.Count() > 1){
                    <td>
                        <table border="0" cellpadding="3" cellspacing="0">
                            <tbody>
                                <tr><td align="center"></td></tr>
                                <tr>
                                    <td valign="top">
                                        @Html.Partial("_Schedule", schedule.LastOrDefault())
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                }
            </tr>
        </tbody>
    </table>
    <hr />
}


@helper GenScheduleLegend(List<Schedulator.Models.Schedule>  schedule){
    <div class="schedLegend">
            @{
                //[Extract enrolments]
                foreach (Schedulator.Models.Enrollment enrollment in schedule.FirstOrDefault().Enrollments) {
                    @RenderSchedules(enrollment)
                }


                if (schedule.Count() > 1) {
                    foreach (Schedulator.Models.Enrollment enrollment in schedule.LastOrDefault().Enrollments) {
                        @RenderSchedules(enrollment)
                    }
                }
            }
    </div>
}

@helper RenderSchedules(Schedulator.Models.Enrollment enrollment){
    //Course header
    var courseBlockColor = enrollment.Course.CourseLetters + enrollment.Course.CourseNumber;

    <div class="@courseBlockColor courseHeader">
        @enrollment.Course.CourseLetters @enrollment.Course.CourseNumber -- @enrollment.Course.Title
    </div>

    //Course Sections
    if (! enrollment.Section.SectionMaster) {
        @RenderSections(@enrollment.Section)
    } else {
                        
        foreach (Schedulator.Models.Section sectionToShow in enrollment.Section.OtherSimilarSections) {
            @RenderSections(sectionToShow)
        }
    }
    <script>courseAltColor('@courseBlockColor');</script>
}

@helper RenderSections(Schedulator.Models.Section sectionToShow) {

    <table>
        <tr>
            <td>Lec @sectionToShow.Lecture.LectureLetter </td>
            <td>@sectionToShow.Lecture.Teacher</td>
            <td>@sectionToShow.Lecture.ClassRoomNumber</td>
        </tr>
        @if (sectionToShow.Tutorial != null)
        { 
        <tr>
            <td>Tut @sectionToShow.Tutorial.TutorialLetter </td>
            <td>@sectionToShow.Tutorial.ClassRoomNumber</td>
        </tr>
        }
        @if (sectionToShow.Lab != null)
        {
            <tr>
                <td>Lab @sectionToShow.Lab.LabLetter </td>
                <td>@sectionToShow.Lab.ClassRoomNumber</td>
            </tr>
        }

    </table>
    if (sectionToShow.SectionMaster)
    {
        foreach (Schedulator.Models.Section sectionToShowFromMaster in sectionToShow.OtherSimilarSections)
        {
            <table>
                <tr>
                    <td>Lec @sectionToShowFromMaster.Lecture.LectureLetter </td>
                    <td>@sectionToShowFromMaster.Lecture.Teacher</td>
                    <td>@sectionToShowFromMaster.Lecture.ClassRoomNumber</td>
                </tr>
                @if (sectionToShowFromMaster.Tutorial != null)
                {
                    <tr>
                        <td>Tut @sectionToShowFromMaster.Tutorial.TutorialLetter </td>
                        <td>@sectionToShowFromMaster.Tutorial.ClassRoomNumber</td>
                    </tr>
                }
                @if (sectionToShowFromMaster.Lab != null)
                {
                    <tr>
                        <td>Lab @sectionToShowFromMaster.Lab.LabLetter </td>
                        <td>@sectionToShowFromMaster.Lab.ClassRoomNumber</td>
                    </tr>
                }

            </table>
        }
    }

}